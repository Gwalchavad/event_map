define("hbs!views/../../templates/event_list",["hbs","handlebars"],function(t,e){var n=e.template(function(t,e,n){n=n||t.helpers;var i,s,o="",a="function",r=this.escapeExpression;return o+="<style>\n    #event_list li{\n        height:",s=n.height,s?i=s.call(e,{hash:{}}):(i=e.height,i=typeof i===a?i():i),o+=r(i)+'px\n    }    \n</style>\n\n<div class="row-fluid top" id="event_list_top_date">\n    <div class="span2 top_text" id="topMonthLetter"></div>\n    <div class="span8">\n        <div class="row-fluid" style="height:60px">\n            <div class="span6" id="topWeekLetter" style="text-align: center">\n                <div style="display: inline-block">\n                    <span id="day_0">S</span>\n                    <span id="day_1">M</span>\n                    <span id="day_2">T</span>\n                    <span id="day_3">W</span>\n                    <span id="day_4">T</span>\n                    <span id="day_5">F</span>\n                    <span id="day_6">S</span>\n                </div>\n            </div>\n            <div style="text-align: center;" class="span4 top_text" id="topYear"></div>\n        </div>\n    </div>\n</div>\n<div id="EventsListView" class="replace overflow setheightWithTop">\n    <div class="row-fluid">\n        <div class="span1">\n            <div class="row-fluid">\n                <div class="span5">\n                    <ul  id="event_list_month">\n                    </ul>\n                </div>\n                <div class="span5">\n                    <ul  id="event_list_day">\n                    </ul>\n                </div>\n            </div>\n        </div>\n        <div class="span9">\n            <ul id="event_list">\n            </ul>\n        </div>\n    </div>\n</div>\n'});return e.registerPartial("views_.._.._templates_event_list",n),n}),define("hbs!views/../../templates/event_list_empty",["hbs","handlebars"],function(t,e){var n=e.template(function(t,e,n){return n=n||t.helpers,'<div id="NoEvent" class="row-fluid top">\n    <div class="span10 top_text" style="text-align: center;">NO EVENTS</div>\n</div>\n<div>\n    <div id="EventsListView" class="replace overflow setheightWithTop">\n        <ul id="event_list">\n        </ul>\n    </div>\n</div>\n\n'});return e.registerPartial("views_.._.._templates_event_list_empty",n),n}),define("hbs!views/../../templates/item_open",["hbs","handlebars"],function(t,e){var n=e.template(function(t,e,n){n=n||t.helpers;var i,s,o="",a="function",r=this.escapeExpression;return o+='<div class="openIndt">[-]</div>\n<div class="list_item_width">\n    <div class="list_item_content">\n        ',s=n.start_time,s?i=s.call(e,{hash:{}}):(i=e.start_time,i=typeof i===a?i():i),o+=r(i)+" - ",s=n.end_time,s?i=s.call(e,{hash:{}}):(i=e.end_time,i=typeof i===a?i():i),o+=r(i)+' <a href="#/event/',s=n.slug,s?i=s.call(e,{hash:{}}):(i=e.slug,i=typeof i===a?i():i),o+=r(i)+'">',s=n.title,s?i=s.call(e,{hash:{}}):(i=e.title,i=typeof i===a?i():i),o+=r(i)+"</a> | ",s=n.content,s?i=s.call(e,{hash:{}}):(i=e.content,i=typeof i===a?i():i),o+=r(i)+"\n    </div>\n</div>\n"});return e.registerPartial("views_.._.._templates_item_open",n),n}),define("hbs!views/../../templates/EventClosedPartial",["hbs","handlebars"],function(t,e){var n=e.template(function(t,e,n,i,s){function o(t,e){var i,s,o="";return o+='\n<li id="event_',s=n.slug,s?i=s.call(t,{hash:{}}):(i=t.slug,i=typeof i===d?i():i),o+=c(i)+'" data-id="',s=n.slug,s?i=s.call(t,{hash:{}}):(i=t.slug,i=typeof i===d?i():i),o+=c(i)+'" data-date="',s=n.start_datetime,s?i=s.call(t,{hash:{}}):(i=t.start_datetime,i=typeof i===d?i():i),o+=c(i)+'" class="event_item">\n        <div class="list_item_container">\n            <div class="openIndt" style="">[+]</div>\n            <div class="list_item_width">\n                <div class="list_item_content" >\n                    ',i=t.complete,i=n["if"].call(t,i,{hash:{},inverse:p.program(4,r,e),fn:p.program(2,a,e)}),(i||0===i)&&(o+=i),o+="\n                </div>\n            </div>\n        </div>\n    </li>\n"}function a(t){var e,i,s="";return s+="\n                        ",i=n.start_time,i?e=i.call(t,{hash:{}}):(e=t.start_time,e=typeof e===d?e():e),s+=c(e)+" - ",i=n.end_time,i?e=i.call(t,{hash:{}}):(e=t.end_time,e=typeof e===d?e():e),s+=c(e)+' <a href="#/event/',i=n.slug,i?e=i.call(t,{hash:{}}):(e=t.slug,e=typeof e===d?e():e),s+=c(e)+'">',e=t.titleClose,e=typeof e===d?e():e,s+=c(e)+"</a>\n                    "}function r(t){var e,i,s="";return s+="\n                        ",i=n.start_time,i?e=i.call(t,{hash:{}}):(e=t.start_time,e=typeof e===d?e():e),s+=c(e)+" - ",i=n.end_time,i?e=i.call(t,{hash:{}}):(e=t.end_time,e=typeof e===d?e():e),s+=c(e)+' <a href="#/event/',i=n.slug,i?e=i.call(t,{hash:{}}):(e=t.slug,e=typeof e===d?e():e),s+=c(e)+'">',e=t.titleClose,e=typeof e===d?e():e,s+=c(e)+"</a>\n                    "}n=n||t.helpers;var l,h="",d="function",c=this.escapeExpression,p=this;return l=e.events,l=n.each.call(e,l,{hash:{},inverse:p.noop,fn:p.program(1,o,s)}),(l||0===l)&&(h+=l),h+="\n"});return e.registerPartial("views_.._.._templates_EventClosedPartial",n),n}),define("hbs!views/../../templates/liMonths",["hbs","handlebars"],function(t,e){var n=e.template(function(t,e,n,i,s){function o(t){var e,i,s="";return s+='\n    <li id="month_',i=n.month,i?e=i.call(t,{hash:{}}):(e=t.month,e=typeof e===l?e():e),s+=h(e)+"_",i=n.year,i?e=i.call(t,{hash:{}}):(e=t.year,e=typeof e===l?e():e),s+=h(e)+'" style="height:',i=n.height,i?e=i.call(t,{hash:{}}):(e=t.height,e=typeof e===l?e():e),s+=h(e)+'px">\n        <div class="rot-90 verticalMonth">',i=n.letter,i?e=i.call(t,{hash:{}}):(e=t.letter,e=typeof e===l?e():e),s+=h(e)+"</div>\n    </li>\n"}n=n||t.helpers;var a,r="",l="function",h=this.escapeExpression,d=this;return a=e.months,a=n.each.call(e,a,{hash:{},inverse:d.noop,fn:d.program(1,o,s)}),(a||0===a)&&(r+=a),r+="\n"});return e.registerPartial("views_.._.._templates_liMonths",n),n}),define("hbs!views/../../templates/liDays",["hbs","handlebars"],function(t,e){var n=e.template(function(t,e,n,i,s){function o(t){var e,i,s="";return s+='\n    <li id="day_',i=n.day,i?e=i.call(t,{hash:{}}):(e=t.day,e=typeof e===l?e():e),s+=h(e)+"_",i=n.month,i?e=i.call(t,{hash:{}}):(e=t.month,e=typeof e===l?e():e),s+=h(e)+"_",i=n.year,i?e=i.call(t,{hash:{}}):(e=t.year,e=typeof e===l?e():e),s+=h(e)+'" style="height:',i=n.height,i?e=i.call(t,{hash:{}}):(e=t.height,e=typeof e===l?e():e),s+=h(e)+'px">',i=n.day,i?e=i.call(t,{hash:{}}):(e=t.day,e=typeof e===l?e():e),s+=h(e)+"</li>\n"}n=n||t.helpers;var a,r="",l="function",h=this.escapeExpression,d=this;return a=e.days,a=n.each.call(e,a,{hash:{},inverse:d.noop,fn:d.program(1,o,s)}),(a||0===a)&&(r+=a),r+="\n"});return e.registerPartial("views_.._.._templates_liDays",n),n}),define("hbs!views/../../templates/popup",["hbs","handlebars"],function(t,e){var n=e.template(function(t,e,n,i,s){function o(t){var e,i,s="";return i=n.scoordy,i?e=i.call(t,{hash:{}}):(e=t.scoordy,e=typeof e===h?e():e),s+=d(e)+",",i=n.scoordx,i?e=i.call(t,{hash:{}}):(e=t.scoordx,e=typeof e===h?e():e),s+=d(e)}n=n||t.helpers;var a,r,l="",h="function",d=this.escapeExpression,c=this;return l+='<span id="popup_',r=n.id,r?a=r.call(e,{hash:{}}):(a=e.id,a=typeof a===h?a():a),l+=d(a)+'"><h3><a href="/#event/',r=n.id,r?a=r.call(e,{hash:{}}):(a=e.id,a=typeof a===h?a():a),l+=d(a)+'">',r=n.title,r?a=r.call(e,{hash:{}}):(a=e.title,a=typeof a===h?a():a),l+=d(a)+"</a></h3>",r=n.start_time,r?a=r.call(e,{hash:{}}):(a=e.start_time,a=typeof a===h?a():a),l+=d(a)+"-",r=n.end_time,r?a=r.call(e,{hash:{}}):(a=e.end_time,a=typeof a===h?a():a),l+=d(a)+' <a class="popupAddress btn btn-info btn-small" href="https://www.google.com/maps?daddr=',r=n.coordy,r?a=r.call(e,{hash:{}}):(a=e.coordy,a=typeof a===h?a():a),l+=d(a)+",",r=n.coordx,r?a=r.call(e,{hash:{}}):(a=e.coordx,a=typeof a===h?a():a),l+=d(a)+"&saddr=",a=e.scoordy,a=n["if"].call(e,a,{hash:{},inverse:c.noop,fn:c.program(1,o,s)}),(a||0===a)&&(l+=a),l+='" target="_blank">Directions</a></span>\n'});return e.registerPartial("views_.._.._templates_popup",n),n}),define("views/list",["jquery","leaflet","underscore","backbone","utils","views/map","hbs!../../templates/event_list","hbs!../../templates/event_list_empty","hbs!../../templates/item_open","hbs!../../templates/EventClosedPartial","hbs!../../templates/liMonths","hbs!../../templates/liDays","hbs!../../templates/popup"],function(t,e,n,i,s,o,a,r,l,h,d,c,p){var u=i.View.extend({tagName:"div",className:"span4",id:"",height:40,openHeight:38,markers:[],render_var:{pre_current_date:{date:new Date},current_date:{date:new Date}},forward_lock:!1,backward_lock:!1,events:{"click .event_item":"onClick","mouseenter .event_item":"onMouseenter","mouseleave .event_item":"onMouseleave"},initialize:function(t){this.constructor.__super__.initialize.apply(this,[t]);var e=this;this.model.on("add",e.onAdd,this),o.map.on("popupopen",this.onPopupOpen),o.map.on("locationfound",this.onLocationFound,this)},onMarkerClick:function(e){this.eventItemOpen(e.target.options.modelID),t(e.target._icon.children).hasClass("viewing")||this.scrollTo(e.target.options.modelID)},onPopupOpen:function(e){t(e.popup._source._icon).find(".circleMarker").show(),t(e.popup._source._icon).find(".layer1").attr("transform","scale(1.2) translate(-1, -3)")},onScroll:function(e){var n=e.data,i=60;i>=t("#EventsListView").scrollTop()?e.data.backFetch(e.data):t("#EventsListView")[0].scrollHeight-t("#EventsListView").scrollTop()<t("#EventsListView").outerHeight()+i&&n.forwardFetch(n),e.data.genarateColorsAndMonths(),e.data.setMonthSideBarPosition()},deScroll:n.debounce(function(t){var e=t.data;e.onScroll(t)},5),backFetch:function(e){var n=e?e:this;n.backward_lock||(n.backward_lock=!0,n.model.rfetch({successCallback:function(e){var i=e.length*n.height;t("#EventsListView").scrollTop(i),n.genarateColorsAndMonths(!0),n.backward_lock=!1}}))},forwardFetch:function(t){var e=t?t:this;e.forward_lock||(e.forward_lock=!0,e.model.ffetch({successCallback:function(){e.genarateColorsAndMonths(!0),e.forward_lock=!1}}))},onAdd:function(n){var i=n.get("location_point"),s=this.model.indexOf(n),a=n.get("start_datetime").format("h:mm A"),r=n.get("end_datetime").format("h:mm A");if(n.set("start_time",a),n.set("end_time",r),i){n.set("coordx",i.coordinates[0]),n.set("coordy",i.coordinates[1]),o.currentPos&&(n.set("scoordx",o.currentPos.lng),n.set("scoordy",o.currentPos.lat));var l=e.divIcon({className:"icon",html:"<div id='icon-"+n.get("slug")+"'></div>",iconAnchor:[9,23],iconSize:[24,30],popupAnchor:[4,-10]}),h=n.get("location_point"),d=e.marker([h.coordinates[1],h.coordinates[0]],{icon:l,modelID:n.get("slug")});d.bindPopup(p(n.toJSON())),o.group.addLayer(d),d.on("click",this.onMarkerClick,this),this.markers[n.get("slug")]=d,t("#icon-"+n.get("slug")).html(t("#svg svg").clone())}this.renderEvent(s,n)},onLocationFound:function(e){this.markers.forEach(function(n){var i=t(n._popup._content),o=i.find(".popupAddress").attr("href");o=s.updateURLParameter(o,"saddr",e.latlng.toUrlString()),i.find(".popupAddress").attr("href",o),n._popup._content=i.prop("outerHTML")})},onClick:function(e){var n=e.currentTarget.id.replace(/event_/,"");t(e.currentTarget).hasClass("open")?(this.eventItemClose(n),this.markers[n]&&this.markers[n].closePopup()):(this.eventItemOpen(n),this.markers[n]&&this.markers[n].openPopup())},onMouseenter:function(e){if(!t(e.currentTarget).hasClass("open")){var n=e.currentTarget.id.replace(/event_/,"");this.markers[n]&&(t("#icon-"+n).parent().css("margin-left",-11).css("margin-top",-27).find(".layer1").attr("transform","scale(1.2) translate(-1, -3)"),this.markers[n].setZIndexOffset(200))}},onMouseleave:function(e){if(!t(e.currentTarget).hasClass("open")){var n=e.currentTarget.id.replace(/event_/,"");this.markers[n]&&(t("#icon-"+n).parent().css("margin-left",-9).css("margin-top",-23).find(".layer1").attr("transform","scale(1)"),this.markers[n].setZIndexOffset(10))}},eventItemOpen:function(e){if(!t("#event_"+e).hasClass("open")){var n=this.model.get(e);t("#event_"+e).addClass("open"),t("#event_"+e).height(this.height+this.openHeight),t("#event_"+e).find(".list_item_container").html(l(n.toJSON()));var i=n.get("start_datetime").date(),s=n.get("start_datetime").month(),o=n.get("start_datetime").year(),a=t("#month_"+s+"_"+o).height();t("#month_"+s+"_"+o).height(a+this.openHeight),a=t("#day_"+i+"_"+s+"_"+o).height(),t("#day_"+i+"_"+s+"_"+o).height(a+this.openHeight),this.markers[e]&&this.markers[e].setZIndexOffset(100)}},eventItemClose:function(e){t("#icon-"+e).find(".circleMarker").hide(),t("#icon-"+e).parent().css("margin-left",-9).css("margin-top",-23).find(".layer1").attr("transform","scale(1)"),t("#event_"+e).removeClass("open"),t("#event_"+e).height(this.height);var n=this.model.get(e),i=n.get("start_datetime").date(),s=n.get("start_datetime").month(),o=n.get("start_datetime").year(),a=t("#day_"+i+"_"+s+"_"+o).height();t("#day_"+i+"_"+s+"_"+o).height(a-this.openHeight),a=t("#month_"+s+"_"+o).height(),t("#month_"+s+"_"+o).height(a-this.openHeight);var r=t("#event_"+e).css("background-color");t("#event_"+e).replaceWith(h({events:[n.toJSON()]})),t("#event_"+e).css("background-color",r),this.setMonthSideBarPosition()},onResize:function(){0!==t("#event_list").length&&this.genarateColorsAndMonths(!0)},onClose:function(){t("#EventsListView").off("scroll."+this.cid)},onDOMadd:function(){this.onResize(),this.backFetch(),this.forwardFetch()},renderEvent:function(e,i){console.log(e,i);var s,o,r=i.get("start_datetime"),l=this.month2FullNameOrLetter(r,0),p=r.date(),u=r.month(),m=r.year(),f={month:u,year:m,height:this.height,letter:l},v={day:p,month:u,year:m,height:this.height},g=d({months:[f]}),_=c({days:[v]}),y=h({events:[i.toJSON()]}),w=this.$el.find("#event_list"),b=w.children().length;if(0===b)return s=a({days:[v],height:this.height}),s=t(s),s.find("#event_list_month").html(g),s.find("#event_list_day").html(_),s.find("#event_list").html(y),this.$el.html(s),this.$el.find("#EventsListView").on("scroll."+this.cid,this,this.onScroll),this;b>e?o="before":(o="after",e=b-1);var k=t(w.children()[e]),L=new Date(k.data("date")),x=L.getUTCDate(),E=L.getUTCMonth(),M=L.getUTCFullYear();if(k[o](y),0===this.$el.find("#month_"+u+"_"+m).length)console.log("inserting month"),this.$el.find("#month_"+E+"_"+M)[o](g),this.$el.find("#day_"+x+"_"+E+"_"+M)[o](_);else{var T=n.bind(function(t,e){return e+this.height},this);this.$el.find("#month_"+u+"_"+m).height(T),l=this.month2FullNameOrLetter(r,this.$el.find("#month_"+u+"_"+m).height()),this.$el.find("#month_"+u+"_"+m).children().text(l),0===this.$el.find("#day_"+p+"_"+u+"_"+m).length?(console.log("inserting day",o,p,this.$el.find("#day_"+x+"_"+E+"_"+M),_),this.$el.find("#day_"+x+"_"+E+"_"+M)[o](_)):this.$el.find("#day_"+p+"_"+u+"_"+m).height(T)}return this},render:function(){var t=r();this.$el.html(t);var e=this;return this.model.forEach(function(t){e.onAdd(t)}),this},genarateColorsAndMonths:function(e){var n=this,i=240,s=document.elementFromPoint(t("#event_list").position().left+.5,t("#EventsListView").position().top+20);if(t(s).attr("class")&&"event_item"==t(s).attr("class").split(" ")[0]&&(this.topVisbleEl!=s||e)){this.topVisbleEl=s;var o=s.id.replace(/event_/,""),a=n.model.get(o).get("start_datetime");this.setMonthDay(a),this.setDay(a);var r=n.isListFull()?t("#EventsListView").height():t("#event_list").height();r-=11;var l=document.elementFromPoint(t("#event_list").position().left,t("#EventsListView").position().top+r),h=t("#event_list").children().index(s),d=t("#event_list").children().index(l);t(".viewed").removeClass("viewing"),t(".viewed").each(function(e,s){var o=s.id.replace(/icon-/,""),r=n.model.get(o);m=a>r.get("start_datetime")?0:i,t(s).find(".svgForeground").css("stroke","grey").css("fill-opacity",.4).css("fill","hsl("+m+",100%, 50%)"),n.markers[o].setZIndexOffset(-10)});for(var c=d-h,p=0;c>=p;++p){var u=t(".event_item")[p+h].id.replace(/event_/,"");if(this.markers[u]){var m=p/c*i;t("#event_"+u).css("background-color","hsl("+m+",100%, 50%)"),t("#icon-"+u).addClass("viewed").addClass("viewing").find(".svgForeground").css("fill","hsl("+m+",100%, 50%)").css("fill-opacity",1).css("stroke","black"),this.markers[u].setZIndexOffset(10)}}}},setDay:function(e){var n=e.day();t(".selected_day").removeClass("selected_day"),t("#day_"+n).addClass("selected_day")},setMonthDay:function(e){var n=e.format("MMM")[0],i=e.date();t("#topMonthLetter").text(n+i),t("#topYear").text(e.year())},setMonthSideBarPosition:function(){var e=20,n=document.elementFromPoint(t("#event_list").position().left+.5,t("#event_list_top_date").height()),i=t(n).data("id"),s=this.model.get(i).get("start_datetime"),o=s.month()+"_"+s.year(),a=t("#month_"+o).position().top+t("#month_"+o).height(),r=t("#month_"+o).children().width(),l=(t("#month_"+o).next().children().width(),t("#month_"+o).children());if(this.current_top_month&&this.current_top_month[0]===l[0]||(t(".monthFixed").removeClass("monthFixed"),this.current_top_month&&this.current_top_month.css("top",0),this.current_top_month=l),a>t("#EventsListView").position().top+r+e)l.addClass("monthFixed").removeClass("relative").css("top",t("#EventsListView").position().top);else{var h=t("#month_"+o).height(),d=h-r-e;0>d&&(d=0),l.addClass("relative").removeClass("monthFixed").css("top",d)}},scrollTo:function(e){var n=t("#EventsListView").scrollTop()-t("#EventsListView").position().top+t("#event_"+e).position().top;t("#EventsListView").animate({scrollTop:n},700)},isListFull:function(){return t("#EventsListView").height()<t("#event_list").height()?!0:!1},month2FullNameOrLetter:function(t,e){var n=e/10;return 10>n?t.format("MMM")[0]:t.format("MMMM")}});return{EventsListView:u}}),define("hbs!views/../../templates/list_info",["hbs","handlebars"],function(t,e){var n=e.template(function(t,e,n,i,s){function o(){return'\n    <a href="#add/event" class="btn btn-large btn-block btn-primary" type="button">Add Event</a>\n    '}n=n||t.helpers;var a,r,l="",h="function",d=this.escapeExpression,c=this;return l+='<div class="row-fluid top">\n    <h1>',r=n.title,r?a=r.call(e,{hash:{}}):(a=e.title,a=typeof a===h?a():a),l+=d(a)+'</h1>\n</div>\n<div id="ListOptionView" style="margin: 20px;">\n    ',r=n.description,r?a=r.call(e,{hash:{}}):(a=e.description,a=typeof a===h?a():a),l+=d(a)+"\n    <br><br>\n    ",a=e.allow_add,a=n["if"].call(e,a,{hash:{},inverse:c.noop,fn:c.program(1,o,s)}),(a||0===a)&&(l+=a),l+='\n    <div id="listOptionPanels">\n    </div>\n</div>\n'});return e.registerPartial("views_.._.._templates_list_info",n),n}),define("views/list_info",["backbone","hbs!../../templates/list_info"],function(t,e){var n=t.View.extend({tagName:"div",className:"replace span3",id:"calender",childrenEL:"#listOptionPanels",render:function(){var t,n=null;return this.model?this.model.getTitle()==app.session.get("username")?(t="MY EVENTS",n=!0):t=this.model.getTitle():(t="ALL EVENTS",n=!0),this.$el.append(e({title:t,allow_add:n,description:intro_text})),this}});return n});