define(["jquery","underscore","backbone","utils","models/users","models/session","jade!../../templates/app_css","jade!../../templates/nav","bootstrap"],function(e,t,n,o,i,r,s,a){var l=n.View.extend({el:"body",height:0,events:{"click #login":"logonmodel","click #markdown":function(){e("#markdown_help").modal()},"click #loginButton":"onLogin","click #logout":"logout","hide #loginhtml":function(){e("#loginError").hide()},"click #signUp":"signUpModel","click #signUpButton":"signUp","hide #signup_html":function(){e("#signupError").hide()}},initialize:function(t){this.constructor.__super__.initialize.apply(this,[t]),this.model.on("change",this.render,this),this.height=e(window).height(),this.$el.append(s({height:this.height-10,topHeight:this.topHeight-10})),this.render(),this.onResize()},onResize:function(){this.height=e(window).height(),this.topHeight=e(window).height()-60,e("#heightStyle").replaceWith(s({height:this.height-1,topHeight:this.topHeight-1})),this.resizeTitleText()},resizeTitleText:function(){var t=e(window).height()-e("#mainNavList").height();e("#site_title").width(t),e("#site_title").textfill();var n=parseInt(e("#site_title span").css("font-size"),10),o=(e("#mainNavList").width()-n)/2;e("#site_title").css("left",120-o)},render:function(){var t=this.model.toJSON();return e("#mainNavList").html(a(t)),this},logonmodel:function(){e("#loginhtml").modal({keyboard:!0})},logout:function(e){var t=this;e.preventDefault(),this.model.destroy({success:function(){t.model.clear(),t.render()}})},login:function(){this.logonmodel();var t=function(){delete this.loginCallback,history.back()};e("#loginhtml").one("hidden",t)},onLogin:function(t){var i=this;t.preventDefault();var r=this.model.save(o.form2object("#loginForm"));r&&(r.error(function(t){var n=JSON.parse(t.responseText);e("#loginError").text(n.errors.message).show("fast")}),r.success(function(){"undfined"!==i.route&&n.history.loadUrl(n.history.fragment),e("#loginhtml").off("hidden"),e("#loginhtml").modal("hide")}))},signUpModel:function(){e("#loginhtml").modal("hide"),e("#signup_html").modal("show"),e(".label").hide()},signUp:function(n){var r=this;n.preventDefault();var s=new i;if(s.on("error",function(n,o){t.each(o,function(t,n){e("#"+n+"_error").show().html(t)})}),s.set(o.form2object("#SignUpForm"))){var a=s.save();a.error(function(n){var o=JSON.parse(n.responseText),i=e("<ul />");t.each(o,function(t){var n=e("<li  />",{text:t.message});i.append(n)}),e("#signupError").html(i).show("fast")}),a.success(function(){r.model.fetch(),e("#signup_html").modal("hide")})}}});return l});